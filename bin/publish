#!/bin/sh

: ${DATE:=$(date +%Y-%m-%d)}
: ${NOTES_URL:=https://notes.wtk.io}
: ${CSS_URL:=https://notes.wtk.io/main.css}
: ${S3_BUCKET:=notes.wtk.io}

set -eu

printf "slug? "
read SLUG

BASENAME="$DATE-$SLUG"

pandoc -s -S -c "$CSS_URL" -t html5 "$1" |
aws s3 cp \
    --content-type text/html \
    --acl public-read \
    - "s3://$S3_BUCKET/$BASENAME"

echo "published to $NOTES_URL/$BASENAME"

if which pbcopy >/dev/null 2>&1; then
    echo "$NOTES_URL/$BASENAME" | pbcopy
    echo "copied URL to clipboard"
fi
